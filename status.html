<html>
<head>
	<title>Hue Status</title>
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
	<link href="https://google-code-prettify.googlecode.com/svn/loader/prettify.css" rel="stylesheet">
	<style type="text/css">

		#lightList .badge {
			margin-right: 8px;
			margin-bottom: 8px;
		}

	</style>
</head>
<body>

  <div class="container">

    <h1>Raspberry Pi Status</h1>

    <div class="tabbable"> <!-- Only required for left/right tabs -->
		  <ul class="nav nav-tabs">
		    <li class="active"><a href="#tabGeneral" data-toggle="tab">General</a></li>
		    <li><a href="#tabHue" data-toggle="tab">Hue Hub Status</a></li>
		    <li><a href="#tabLights" data-toggle="tab">Lights</a></li>
		    <li><a href="#tabAC" data-toggle="tab">Air Conditioners</a></li>
		    <li><a href="#tabAll" data-toggle="tab">All</a></li>
		  </ul>
		  <div class="tab-content">
		    <div class="tab-pane active" id="tabGeneral">
		      <table class="table table-striped">
		      	<tr>
		      		<td style="min-width:150px;">Last Updated</td><td id="piUpdated"></td>
		      	</tr>
		      	<tr>
		      		<td>Up Time (seconds)</td><td id="piUpTime"></td>
		      	</tr>
		      	<tr>
		      		<td>Door</td><td><span class="label" id="piDoor"></span></td>
		      	</tr>
		      	<tr>
		      		<td>System Status</td><td><span class="label" id="piAway"></span></td>
		      	</tr>
		      	<tr>
		      		<td>Hue Bridge IP</td><td id="piHueIP"></td>
		      	</tr>
		      	<tr>
		      		<td>iTach IP</td><td id="piITachIP"></td>
		      	</tr>
		      	<tr>
		      		<td>Light Status</td>
		      		<td id="lightList"></td>
		      	</tr>
		      	<tr>
		      		<td>Inside Temperature</td>
		      		<td><span class="badge" id="piTempInside"></span></td>
		      	</tr>
		      	<tr>
		      		<td>Outside Temperature</td>
		      		<td><span class="badge" id="piTempOutside"></span></td>
		      	</tr>
					</table>
		    </div>
		    <div class="tab-pane" id="tabHue">
		      <pre id="jsonHue" class="prettyprint lang-js">
    			</pre>
		    </div>
		    <div class="tab-pane" id="tabLights">
		    	<div id="xlightList"></div>
		      <pre id="jsonLights" class="prettyprint lang-js">
    			</pre>
		    </div>
		    <div class="tab-pane" id="tabAC">
		      <pre id="jsonAC" class="prettyprint lang-js">
    			</pre>
		    </div>
		    <div class="tab-pane" id="tabAll">
		      <pre id="jsonAll" class="prettyprint lang-js">
    			</pre>
		    </div>
		  </div>
		</div>
  </div>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="//google-code-prettify.googlecode.com/svn/loader/prettify.js"></script>
	<script type="text/javascript">

		function updateData() {
			$.ajax({
	  		url: "status.json?x=1"
			}).done(function(status) {
				$("#jsonHue").text(JSON.stringify(status.config, undefined, 2));
				$("#jsonLights").text(JSON.stringify(status.lights, undefined, 2));
				$("#jsonAC").text(JSON.stringify(status.airConditioners, undefined, 2));
				$("#jsonAll").text(JSON.stringify(status, undefined, 2));
				$("#piUpdated").text(status.updatedAt);
				$("#piITachIP").text(status.itachIP);
				$("#piHueIP").text(status.hueBridgeIP);
				$("#piUpTime").text(status.upTime);
				if (status.isDoorOpen) {
					$("#piDoor").text("Open").addClass("label-important")
				} else {
					$("#piDoor").text("Closed").addClass("label-success")
				}
				if (status.away) {
					$("#piAway").text("Away").addClass("label-important")
				} else {
					$("#piAway").text("Home").addClass("label-success")
				}
				if (status.insideTemperature == -1) {

				} else if (status.insideTemperature < 40) {
					$("#piTempInside").addClass("badge-info");
				} else if (status.insideTemperature < 60) {
					$("#piTempInside").addClass("badge-warning");
				} else if (status.insideTemperature < 75) {
					$("#piTempInside").addClass("badge-success");
				} else if (status.insideTemperature < 85) {
					$("#piTempInside").addClass("badge-warning");
				} else {
					$("#piTempInside").addClass("badge-important");
				}
				$("#piTempInside").html(status.insideTemperature + "&deg;");
				$("#piTempOutside").html(status.outsideTemperature + "&deg;");
				var i = 1;
				var lightContainer = $("<span></span>")
				while (status.lights[i]) {
					var light = status.lights[i];
					var item = $("<span class='badge'></span>");
					item.text(light.name)
					if (light.state.on) {
						item.addClass("badge-success");
					} else {
						item.addClass("badge-inverse");
					}
					lightContainer.append(item);
					i++;
				}
				$("#lightList").html(lightContainer);
				$(".prettyprinted").removeClass("prettyprinted");
	  		prettyPrint()
	  		window.pi = status;
			});
		}

		updateData();
		setInterval(updateData, 10000);

	</script>
</body>
</html>